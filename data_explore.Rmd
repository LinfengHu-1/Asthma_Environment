---
title: "data_exploration"
author: "Pluto Zhang"
date: "2022-10-07"
output:
  html_document:
    df_print: paged
---

```{r}
library(rstudioapi)
library(tidyverse)
library(gam)
library(splines)
library(splines2)  
library(dplyr)
library(tidyr)
library(broom)
library(dslabs)
library(ggplot2)
library(ggthemes)
library(ggrepel)
# data cleaning for socio economic factors
soecon <- read_csv('soecon.csv')
dat_full <- read.csv("fulldata.csv")

```


```{r}
names(soecon)
```



Run a summary of the variables in socioeconomic category
```{r}
summary(soecon)
```



Draw histograms of the variables in the dataset
```{r}

hist(soecon$SNAP, main='Histogram of SNAP enrollment across states', xlab = 'per 10,000 people' )

hist(soecon$individual_homeless, main = 'Histogram of homeless individuals across states', xlab = 'per 10,000 people')

hist(soecon$fam_homeless, main = 'Histogram of homeless in families across states', xlab = 'per 10,000 people')

hist(soecon$total_homeless, main = 'Histogram of total homeless people across states ', xlab = 'per 10,000 people')

hist(soecon$unemployment_rate, main='Histogram of unemployment rate across states', xlab = 'unemployment rate')

hist(soecon$Female_poverty, main='Histogram of female poverty percentage across states', xlab = 'percentage of total female population')

```
```{r}
pairs(soecon$total_homeless ~ soecon$SNAP + soecon$unemployment_rate + soecon$Total_poverty )
```
Based on the paired scatter plot, there is no obvious colinearity between the four main socioeconomic variables: SNAP enrollment, total_poverty rate, unemployment rate and total number of homeless people, which means that these four variables are independent with each other. 


```{r}
# for the homeless variable, test for colinearity between its three subvariables 
pairs(soecon$total_homeless ~ soecon$individual_homeless + soecon$fam_homeless)
```
```{r}
# for the homeless variable, test for colinearity between its three subvariables 
pairs(soecon$Total_poverty ~ soecon$individual_homeless + soecon$fam_homeless)
```

```{r}
fulldat <- read_csv('FullData.csv')
names(fulldat)[names(fulldat) == 'DataValue'] <- 'Asthmap'
names(fulldat)[names(fulldat) == 'TOBDataValue'] <- 'TOB'


# now we try to determine which variable is more significant in predicting the Asthma prevalence
# forward selection
coln <- colnames(fulldat)

coln
fulldat <- fulldat |> drop_na()

require(broom)
#forward selection procedure using AIC values 
lm1 <- lm(Asthmap ~ 1, data=fulldat)
stepModel <- step(lm1, direction="forward",
scope=(~ selfHlthDataValue + HlthCareDataValue + SNAP+ individual_homeless+fam_homeless+total_homeless+unemployment_rate+Male_poverty+Female_poverty+Total_poverty+o3_mean+pm2.5_mean+so2_mean+co_mean+no2_mean), data=fulldat)

```


#### CDI data
```{r}
names(fulldat[, 1:25])
```
```{r}
summary(fulldat[, 4:25])
```
```{r}
par(mfrow = c(2,2))
hist(fulldat$Asthmap, main='Histogram of asthma crude prevalence 
     among women aged 18-44 years across states')
hist(fulldat$TOB, main='Histogram of Percent current cigarette smoking 
     among women aged 18-44 years across states')
hist(fulldat$selfHlthDataValue, main = 'Histogram of Self-rated health status 
     among women aged 18-44 years across states')
hist(fulldat$HlthCareDataValue, main = 'Histogram of Current health care coverage 
     among women aged 18-44 years across states')
```


```{r}
pairs(TOB ~ selfHlthDataValue + HlthCareDataValue, data = fulldat)
```
We can see here that there's no obvious co-linearity between our covariates.
```{r}
#CDI exploratory
plot(fulldat$Asthmap ~ fulldat$TOB, ylab = "Asthma Pervalence", xlab = "Tobacco smoked")
plot(fulldat$Asthmap ~ fulldat$selfHlthDataValue,ylab = "Asthma Pervalence", xlab = "self-reported health status")
plot(fulldat$Asthmap ~ fulldat$HlthCareDataValue,ylab = "Asthma Pervalence", xlab = "healthcare coverage")
```



#### Air pollution data
```{r}
#air pollutant exploratory

par(mfrow = c(3,2))
plot(fulldat$Asthmap ~ fulldat$o3_mean, ylab = "Asthma Pervalence", xlab = expression(O[3]~(ppm)))
plot(fulldat$Asthmap ~ fulldat$pm2.5_mean,ylab = "Asthma Pervalence", xlab = expression(PM[2.5]~(ug/m^3)))
plot(fulldat$Asthmap ~ fulldat$so2_mean,ylab = "Asthma Pervalence", xlab = expression(SO[2]~(ppb)))
plot(fulldat$Asthmap ~ fulldat$co_mean, ylab = "Asthma Pervalence", xlab = "CO (ppm)")
plot(fulldat$Asthmap ~ fulldat$no2_mean, ylab = "Asthma Pervalence", xlab = expression(NO[2]~(ppb)))
```

```{r}
pairs(o3_mean ~ pm2.5_mean + so2_mean + co_mean + no2_mean, data = fulldat)
```
